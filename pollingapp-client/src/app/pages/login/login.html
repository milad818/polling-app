<div class="login-page">
  <!-- Infinite Tech Scroll Banner -->
  <div class="tech-scroll-banner">
    <div class="tech-scroll-track">
      @for (tech of techItems; track tech) {
        <span class="tech-item">{{ tech }}</span>
      }
      @for (tech of techItems; track tech; let i = $index) {
        <span class="tech-item duplicate">{{ tech }}</span>
      }
    </div>
  </div>

  <!-- Animated Title -->
  <div class="login-title-container">
    <h1 class="login-title">
      <span class="title-icon">&#9881;</span>
      <span class="title-text">PollingApp</span>
      <span class="title-icon">&#9881;</span>
    </h1>
    <p class="login-subtitle">Create polls, share opinions, make decisions</p>
  </div>

  <!-- Auth Card -->
  <div class="auth-wrapper">
    <div class="auth-card" [class.flipped]="isSignUp">
      <!-- Sign In Panel -->
      <div class="auth-panel sign-in-panel">
        <h2 class="panel-title">Welcome Back</h2>
        <p class="panel-subtitle">Sign in to your account</p>

        @if (errorMessage && !isSignUp) {
          <div class="error-banner">{{ errorMessage }}</div>
        }

        <form #signInForm="ngForm" (ngSubmit)="onSignIn()" class="auth-form">
          <div class="form-field">
            <div class="input-group">
              <span class="input-icon">&#9993;</span>
              <input
                type="email"
                name="signInEmail"
                [(ngModel)]="signInEmail"
                placeholder="Email address"
                required
                email
                #siEmail="ngModel"
              />
            </div>
            @if (siEmail.touched && siEmail.invalid) {
              <div class="field-validation invalid">
                Enter a valid email address (e.g. user&#64;example.com)
              </div>
            }
            @if (siEmail.touched && siEmail.valid) {
              <div class="field-validation valid">Looks good!</div>
            }
          </div>

          <div class="form-field">
            <div class="input-group">
              <span class="input-icon">&#128274;</span>
              <input
                type="password"
                name="signInPassword"
                [(ngModel)]="signInPassword"
                placeholder="Password"
                required
                minlength="4"
                #siPassword="ngModel"
              />
            </div>
            @if (siPassword.touched && siPassword.invalid) {
              <div class="field-validation invalid">Password is required.</div>
            }
          </div>

          <button type="submit" class="auth-btn" [disabled]="signInForm.invalid || isLoading">
            {{ isLoading ? 'Signing in...' : 'Sign In' }}
          </button>
        </form>

        <div class="toggle-section">
          <p>
            Don't have an account?
            <button type="button" class="toggle-btn" (click)="toggleMode()">Sign Up</button>
          </p>
        </div>
      </div>

      <!-- Sign Up Panel -->
      <div class="auth-panel sign-up-panel">
        <h2 class="panel-title">Create Account</h2>
        <p class="panel-subtitle">Join the community</p>

        @if (errorMessage && isSignUp) {
          <div class="error-banner">{{ errorMessage }}</div>
        }

        <form #signUpForm="ngForm" (ngSubmit)="onSignUp()" class="auth-form">
          <div class="form-field">
            <div class="input-group">
              <span class="input-icon">&#9993;</span>
              <input
                type="email"
                name="signUpEmail"
                [(ngModel)]="signUpEmail"
                placeholder="Email address"
                required
                email
                #suEmail="ngModel"
              />
            </div>
            @if (suEmail.touched && !isSignUpEmailValid) {
              <div class="field-validation invalid">
                Enter a valid email address. Your username will be extracted from it.
              </div>
            }
            @if (suEmail.touched && isSignUpEmailValid) {
              <div class="field-validation valid">Looks good!</div>
            }
          </div>

          <div class="form-field">
            <div class="input-group">
              <span class="input-icon">&#128274;</span>
              <input
                type="password"
                name="signUpPassword"
                [(ngModel)]="signUpPassword"
                placeholder="Password"
                required
                #suPassword="ngModel"
              />
            </div>
            @if (suPassword.touched) {
              <div class="password-rules">
                <div class="pw-rule" [class.met]="hasMinLength">
                  {{ hasMinLength ? '✓' : '✗' }} At least 10 characters
                </div>
                <div class="pw-rule" [class.met]="hasUpperCase">
                  {{ hasUpperCase ? '✓' : '✗' }} 1 uppercase letter
                </div>
                <div class="pw-rule" [class.met]="hasLowerCase">
                  {{ hasLowerCase ? '✓' : '✗' }} 1 lowercase letter
                </div>
                <div class="pw-rule" [class.met]="hasNumber">
                  {{ hasNumber ? '✓' : '✗' }} 1 number
                </div>
                <div class="pw-rule" [class.met]="hasSpecialChar">
                  {{ hasSpecialChar ? '✓' : '✗' }} 1 special character
                </div>
              </div>
            }
          </div>

          <div class="form-field">
            <div class="input-group">
              <span class="input-icon">&#128275;</span>
              <input
                type="password"
                name="signUpConfirmPassword"
                [(ngModel)]="signUpConfirmPassword"
                placeholder="Confirm password"
                required
                #suConfirm="ngModel"
              />
            </div>
            @if (suConfirm.touched && signUpConfirmPassword.length > 0 && !passwordsMatch) {
              <div class="field-validation invalid">Passwords do not match.</div>
            }
            @if (suConfirm.touched && signUpConfirmPassword.length > 0 && passwordsMatch) {
              <div class="field-validation valid">Passwords match!</div>
            }
          </div>

          <button
            type="submit"
            class="auth-btn"
            [disabled]="!isSignUpEmailValid || !isPasswordValid || !passwordsMatch || isLoading"
          >
            {{ isLoading ? 'Creating account...' : 'Sign Up' }}
          </button>
        </form>

        <div class="toggle-section">
          <p>
            Already have an account?
            <button type="button" class="toggle-btn" (click)="toggleMode()">Sign In</button>
          </p>
        </div>
      </div>
    </div>
  </div>
</div>
